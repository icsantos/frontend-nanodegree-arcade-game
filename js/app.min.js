var BLOCK_WIDTH=101,BLOCK_HEIGHT=83,BLOCK_HEIGHT_OFFSET=50;var FIELD_TOP=BLOCK_HEIGHT_OFFSET,FIELD_LEFT=0,FIELD_BOTTOM=400,FIELD_RIGHT=400;function randomInteger(min,max){'use strict';return Math.floor(Math.random()*(max-min+1)+min);}
function toggleAvatarSelection(enable){'use strict';if(enable){$('input[name=player]').prop('disabled',false);$('label > input + img').css('cursor','pointer');}else{$('input[name=player]').prop('disabled',true);$('label > input + img').css('cursor','default');}}
var GamePiece=function(){'use strict';};GamePiece.prototype.piece=function(obj){'use strict';this.sprite=obj.sprite;this.width=obj.width;this.height=obj.height;};GamePiece.prototype.xCoord=function(min,max){'use strict';var randCol=randomInteger(min,max)*BLOCK_WIDTH;this.x=randCol+(BLOCK_WIDTH-this.width)/2;};GamePiece.prototype.yCoord=function(min,max){'use strict';var randRow=randomInteger(min,max)*BLOCK_HEIGHT;this.y=BLOCK_HEIGHT_OFFSET+randRow+(BLOCK_HEIGHT-this.height)/2;};GamePiece.prototype.setPerimeter=function(){'use strict';this.perimeter={top:this.y,left:this.x,bottom:this.y+this.height,right:this.x+this.width};};GamePiece.prototype.render=function(){'use strict';ctx.drawImage(Resources.get(this.sprite),this.x,this.y);};GamePiece.prototype.hit=function(object2){'use strict';var hit=false;if(this.perimeter&&object2.perimeter){hit=(this.perimeter.left<object2.perimeter.right&&this.perimeter.right>object2.perimeter.left&&this.perimeter.top<object2.perimeter.bottom&&this.perimeter.bottom>object2.perimeter.top);}
return hit;};var enemies=[{sprite:'images/enemy-bug.png',width:99,height:66},{sprite:'images/ladybag.png',width:63,height:66}];var Enemy=function(){'use strict';GamePiece.call(this);this.reset();};Enemy.prototype=Object.create(GamePiece.prototype);Enemy.prototype.constructor=Enemy;Enemy.prototype.reset=function(){'use strict';this.piece(enemies[randomInteger(1,enemies.length)-1]);this.xCoord(-3,-1);this.yCoord(1,3);this.speed=randomInteger(75,200);};Enemy.prototype.update=function(dt){'use strict';this.x+=this.speed*dt;this.y+=randomInteger(-1,1)/3;this.setPerimeter();if(this.x>FIELD_RIGHT+BLOCK_WIDTH){this.reset();}
if(this.hit(player)){player.updateLives(-1);player.reset();}};var avatars=[{id:'char-boy',sprite:'images/char-boy.png',width:67,height:77},{id:'char-cat-girl',sprite:'images/char-cat-girl.png',width:68,height:76},{id:'char-horn-girl',sprite:'images/char-horn-girl.png',width:67,height:77},{id:'char-pink-girl',sprite:'images/char-pink-girl.png',width:68,height:76},{id:'char-princess-girl',sprite:'images/char-princess-girl.png',width:68,height:78}];var Player=function(charId){'use strict';GamePiece.call(this);var obj,index,radio;if(typeof charId!=="undefined"&&charId){obj=$.grep(avatars,function(e){return e.id===charId;})[0];}else{index=randomInteger(1,avatars.length)-1;radio='input[name=player]:eq('+index+')';$(radio).prop('checked',true);toggleAvatarSelection(false);obj=avatars[index];}
this.piece(obj);this.score=0;this.lives=3;this.reset();};Player.prototype=Object.create(GamePiece.prototype);Player.prototype.constructor=Player;Player.prototype.reset=function(){'use strict';this.xCoord(0,4);this.yCoord(5,5);this.setPerimeter();this.tokenPoints=0;this.tokenLives=0;};Player.prototype.update=function(){'use strict';if(this.lives<1){this.gameOver();return 0;}
if(this.y<FIELD_TOP){this.updateScore(1+this.tokenPoints);this.updateLives(this.tokenLives);this.reset();}
this.setPerimeter();return 1;};Player.prototype.handleInput=function(key){'use strict';switch(key){case'up':this.y-=(this.y>FIELD_TOP)?BLOCK_HEIGHT:0;break;case'left':this.x-=(this.x-BLOCK_WIDTH>FIELD_LEFT)?BLOCK_WIDTH:0;break;case'down':this.y+=(this.y<FIELD_BOTTOM)?BLOCK_HEIGHT:0;break;case'right':this.x+=(this.x<FIELD_RIGHT)?BLOCK_WIDTH:0;break;}};Player.prototype.updateScore=function(score){'use strict';this.score+=score;$('#score').text(this.score);};Player.prototype.updateLives=function(lives){'use strict';this.lives=(this.lives+lives>=5)?5:this.lives+lives;$('img.life').each(function(index){if(index<player.lives){$(this).removeClass('inactive').addClass('active');}else{$(this).removeClass('active').addClass('inactive');}});};Player.prototype.gameOver=function(){'use strict';$('#score').text("Your Score: "+this.score);};var tokens=[{sprite:'images/Gem Blue.png',width:50,height:54,points:2,lives:0},{sprite:'images/Gem Green.png',width:50,height:54,points:4,lives:0},{sprite:'images/Gem Orange.png',width:50,height:54,points:8,lives:0},{sprite:'images/Key.png',width:50,height:50,points:16,lives:0},{sprite:'images/Star.png',width:29,height:42,points:32,lives:0},{sprite:'images/Heart.png',width:45,height:45,points:0,lives:1}];var Token=function(){'use strict';GamePiece.call(this);this.reset();};Token.prototype=Object.create(GamePiece.prototype);Token.prototype.constructor=Token;Token.prototype.reset=function(){'use strict';var obj=tokens[randomInteger(1,tokens.length)-1];this.piece(obj);this.points=obj.points;this.lives=obj.lives;this.delay=randomInteger(2,10)*10000;this.fadeTime=randomInteger(5,10)*10000;this.alphaDivisor=this.fadeTime;this.xCoord(0,4);this.yCoord(1,3);};Token.prototype.update=function(){'use strict';this.setPerimeter();if(this.delay<=0&&this.hit(player)){player.tokenPoints+=this.points;player.tokenLives+=this.lives;this.reset();}};Token.prototype.render=function(){'use strict';this.delay-=100;if(this.delay<=0){this.fadeTime-=100;if(this.fadeTime<=0){this.reset();}else{ctx.globalAlpha=this.fadeTime/this.alphaDivisor;GamePiece.prototype.render.call(this);ctx.globalAlpha=1.0;}}};var allEnemies=[new Enemy(),new Enemy(),new Enemy(),new Enemy(),new Enemy(),new Enemy()],player=new Player(),token=new Token();document.addEventListener('keyup',function(e){'use strict';var allowedKeys={37:'left',38:'up',39:'right',40:'down'};player.handleInput(allowedKeys[e.keyCode]);});$('input[name="player"]').change(function(){'use strict';console.log($(this).val());var player=new Player($(this).val());});