<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** 
 * Size of a stone, grass or water block along x-axis.
 * @constant
 * @type {number}
 * @default
 */
var BLOCK_WIDTH = 101,
  /** 
   * Size of a stone, grass or water block along y-axis.
   * @constant
   * @type {number}
   * @default
   */
  BLOCK_HEIGHT = 83,
  /** 
   * Transparent part of a stone, grass or water block above the block image.
   * @constant
   * @type {number}
   * @default
   */
  BLOCK_HEIGHT_OFFSET = 50;

/** 
 * Top of the playing field.
 * @constant
 * @type {number}
 * @default BLOCK_HEIGHT_OFFSET
 */
var FIELD_TOP = BLOCK_HEIGHT_OFFSET,
  /** 
   * Left side of the playing field.
   * @constant
   * @type {number}
   * @default
   */
  FIELD_LEFT = 0,
  /** 
   * Bottom of the playing field.
   * @constant
   * @type {number}
   * @default
   */
  FIELD_BOTTOM = 400,
  /** 
   * Right side of the playing field.
   * @constant
   * @type {number}
   * @default
   */
  FIELD_RIGHT = 400;

/**
 * Generate a random integer between &lt;tt>min&lt;/tt> and &lt;tt>max&lt;/tt>
 * to use for speed and coordinates.
 * @param {number} min - The lower bound; this can be a negative value.
 * @param {number} max - The upper bound.
 * @returns {number}
 */
function randomInteger(min, max) {
  'use strict';
  return Math.floor(Math.random() * (max - min + 1) + min);
}

/**
 * Toggle on or off the selection of the player's avatar.
 * @param {boolean} enable - &lt;em>true&lt;/em> | &lt;em>false&lt;/em>
 *   &lt;p>Set it to &lt;em>true&lt;/em> to allow the player to pick an avatar.&lt;/p>
 *   &lt;p>Set it to &lt;em>false&lt;/em> during game play.&lt;/p>
 */
function toggleAvatarSelection(enable) {
  'use strict';
  if (enable) {
    $('input[name=player]').prop('disabled', false);
    $('label > input + img').css('cursor', 'pointer');
  } else {
    $('input[name=player]').prop('disabled', true);
    $('label > input + img').css('cursor', 'default');
  }
}

// --------------------------------------------------
// GamePiece superclass
// --------------------------------------------------
/**
 * A superclass of the playing pieces we can use in the game.
 * @constructor
 */
var GamePiece = function () {
  'use strict';
};

/**
 * Represents a playing piece.
 * @param {object} obj - An object containing the image sprite URL, width and height.
 * @example
 * // Sample value for the obj parameter
 * {
 *    sprite: 'images/enemy-bug.png',
 *    width: 99,
 *    height: 66
 * }
 * @property {string} sprite - The URL of the image sprite.  The image/sprite uses a helper to easily load images.
 * @property {number} width - The width of the image sprite.
 * @property {number} height - The height of the image sprite.
 */
GamePiece.prototype.piece = function (obj) {
  'use strict';
  this.sprite = obj.sprite;
  this.width = obj.width;
  this.height = obj.height;
};

/**
 * Place the game piece in the middle of a randomly chosen column.
 * @param {number} min - The lower bound; this can be a negative value.
 * @param {number} max - The upper bound.
 * @property {number} x - The location of the game piece on the x-axis.
 */
GamePiece.prototype.xCoord = function (min, max) {
  'use strict';
  var randCol = randomInteger(min, max) * BLOCK_WIDTH;
  this.x = randCol + (BLOCK_WIDTH - this.width) / 2;
};


/**
 * Place the game piece in the middle of a randomly chosen row.
 * @param {number} min - The lower bound; keep it between 1 and 5.
 * @param {number} max - The upper bound; keep it between 1 and 5.
 * @property {number} y - The location of the game piece on the y-axis.
 */
GamePiece.prototype.yCoord = function (min, max) {
  'use strict';
  var randRow = randomInteger(min, max) * BLOCK_HEIGHT;
  this.y = BLOCK_HEIGHT_OFFSET + randRow + (BLOCK_HEIGHT - this.height) / 2;
};

/**
 * Set the game piece's 'hit' zone for use in collision detection.
 * @property {object} perimeter - The boundaries of the game piece on the x-axis and y-axis.
 * @property {number} perimeter.top - The top of the game piece.
 * @property {number} perimeter.left - The left side of the game piece.
 * @property {number} perimeter.bottom - The bottom of the game piece.
 * @property {number} perimeter.right - The right side of the game piece.
 */
GamePiece.prototype.setPerimeter = function () {
  'use strict';
  this.perimeter = {
    top: this.y,
    left: this.x,
    bottom: this.y + this.height,
    right: this.x + this.width
  };
};

/**
 * Draw the game piece on the screen.
 */
GamePiece.prototype.render = function () {
  'use strict';
  ctx.drawImage(Resources.get(this.sprite), this.x, this.y);
};

/**
 * Detect if this game piece was hit by another game piece.
 * @see https://developer.mozilla.org/en-US/docs/Games/Techniques/2D_collision_detection
 * @param {object} object2 - An object representing a second game piece
 * @returns {boolean} &lt;em>true&lt;/em> | &lt;em>false&lt;/em>
 * @default &lt;em>false&lt;/em>
 */
GamePiece.prototype.hit = function (object2) {
  'use strict';
  var hit = false;
  if (this.perimeter &amp;&amp; object2.perimeter) {
    hit = (this.perimeter.left &lt; object2.perimeter.right &amp;&amp;
      this.perimeter.right > object2.perimeter.left &amp;&amp;
      this.perimeter.top &lt; object2.perimeter.bottom &amp;&amp;
      this.perimeter.bottom > object2.perimeter.top);
  }
  return hit;
};

// --------------------------------------------------
// Enemy class
// --------------------------------------------------
var enemies = [
  {
    sprite: 'images/enemy-bug.png',
    width: 99,
    height: 66
  }, {
    // https://pixabay.com/en/handbag-bag-brown-clutch-leather-155755/
    sprite: 'images/ladybag.png',
    width: 63,
    height: 66
  }
];

/**
 * @constructor
 * @extends GamePiece
 */
var Enemy = function () {
  'use strict';
  GamePiece.call(this);
  this.reset();
};
Enemy.prototype = Object.create(GamePiece.prototype); // subclass prototype delegation
Enemy.prototype.constructor = Enemy; // reset constructor from GamePiece to Enemy

// Place enemy at one of the stone-block rows (y-axis), starting off-canvas (x-axis)
Enemy.prototype.reset = function () {
  'use strict';
  this.piece(enemies[randomInteger(1, enemies.length) - 1]);
  this.xCoord(-3, -1);
  this.yCoord(1, 3);
  this.speed = randomInteger(75, 200);
};

// Update the enemy's position
// Parameter: dt, a time delta between ticks
Enemy.prototype.update = function (dt) {
  'use strict';
  // Multiply any movement by the dt parameter to ensure
  // the game runs at the same speed for all computers.
  this.x += this.speed * dt;
  // give the bug a little up-and-down jiggle
  this.y += randomInteger(-1, 1) / 3;
  this.setPerimeter();
  // Has the enemy walked off the right side?
  if (this.x > FIELD_RIGHT + BLOCK_WIDTH) {
    this.reset();
  }
  if (this.hit(player)) {
    player.updateLives(-1);
    player.reset();
  }
};

// --------------------------------------------------
// Player class
// --------------------------------------------------
// for purpose of collision detection, the height excludes the shadow
var avatars = [
  {
    id: 'char-boy',
    sprite: 'images/char-boy.png',
    width: 67,
    height: 77
  }, {
    id: 'char-cat-girl',
    sprite: 'images/char-cat-girl.png',
    width: 68,
    height: 76
  }, {
    id: 'char-horn-girl',
    sprite: 'images/char-horn-girl.png',
    width: 67,
    height: 77
  }, {
    id: 'char-pink-girl',
    sprite: 'images/char-pink-girl.png',
    width: 68,
    height: 76
  }, {
    id: 'char-princess-girl',
    sprite: 'images/char-princess-girl.png',
    width: 68,
    height: 78
  }
];

var Player = function (charId) {
  'use strict';
  GamePiece.call(this);
  var obj,
    index,
    radio;
  if (typeof charId !== "undefined" &amp;&amp; charId) {
    obj = $.grep(avatars, function (e) { return e.id === charId; })[0];
  } else {
    index = randomInteger(1, avatars.length) - 1;
    radio = 'input[name=player]:eq(' + index + ')';
    $(radio).prop('checked', true);
    toggleAvatarSelection(false);
    obj = avatars[index];
  }
  this.piece(obj);
  this.score = 0;
  this.lives = 3;
  this.reset();
};
Player.prototype = Object.create(GamePiece.prototype); // subclass prototype delegation
Player.prototype.constructor = Player; // reset constructor from GamePiece to Player

// Place player at starting point
Player.prototype.reset = function () {
  'use strict';
  this.xCoord(0, 4);
  this.yCoord(5, 5);
  this.setPerimeter();
  this.tokenPoints = 0;
  this.tokenLives = 0;
};

// Update the player's position
Player.prototype.update = function () {
  'use strict';
  if (this.lives &lt; 1) {
    this.gameOver();
    return 0;
  }
  // Has the player reached the water?
  if (this.y &lt; FIELD_TOP) {
    this.updateScore(1 + this.tokenPoints);
    this.updateLives(this.tokenLives);
    this.reset();
  }
  this.setPerimeter();
  return 1;
};

// Move player in the direction selected
Player.prototype.handleInput = function (key) {
  'use strict';
  switch (key) {
  case 'up':
    this.y -= (this.y > FIELD_TOP) ? BLOCK_HEIGHT : 0;
    break;
  case 'left':
    this.x -= (this.x - BLOCK_WIDTH > FIELD_LEFT) ? BLOCK_WIDTH : 0;
    break;
  case 'down':
    this.y += (this.y &lt; FIELD_BOTTOM) ? BLOCK_HEIGHT : 0;
    break;
  case 'right':
    this.x += (this.x &lt; FIELD_RIGHT) ? BLOCK_WIDTH : 0;
    break;
  }
};

// Update the player's score
Player.prototype.updateScore = function (score) {
  'use strict';
  this.score += score;
  $('#score').text(this.score);
};

// Update the player's lives
Player.prototype.updateLives = function (lives) {
  'use strict';
  this.lives = (this.lives + lives >= 5) ? 5 : this.lives + lives;
  $('img.life').each(function (index) {
    if (index &lt; player.lives) {
      $(this).removeClass('inactive').addClass('active');
    } else {
      $(this).removeClass('active').addClass('inactive');
    }
  });
};

// No more lives
Player.prototype.gameOver = function () {
  'use strict';
  $('#score').text("Your Score: " + this.score);
};

// --------------------------------------------------
// Token class
// --------------------------------------------------
var tokens = [
  {
    sprite: 'images/Gem Blue.png',
    width: 50,
    height: 54,
    points: 2,
    lives: 0
  }, {
    sprite: 'images/Gem Green.png',
    width: 50,
    height: 54,
    points: 4,
    lives: 0
  }, {
    sprite: 'images/Gem Orange.png',
    width: 50,
    height: 54,
    points: 8,
    lives: 0
  }, {
    sprite: 'images/Key.png',
    width: 50,
    height: 50,
    points: 16,
    lives: 0
  }, {
    sprite: 'images/Star.png',
    width: 29,
    height: 42,
    points: 32,
    lives: 0
  }, {
    sprite: 'images/Heart.png',
    width: 45,
    height: 45,
    points: 0,
    lives: 1
  }
];

var Token = function () {
  'use strict';
  GamePiece.call(this);
  this.reset();
};
Token.prototype = Object.create(GamePiece.prototype); // subclass prototype delegation
Token.prototype.constructor = Token; // reset constructor from GamePiece to Token

// Token will be placed on a stone-block
Token.prototype.reset = function () {
  'use strict';
  var obj = tokens[randomInteger(1, tokens.length) - 1];
  this.piece(obj);
  this.points = obj.points;
  this.lives = obj.lives;
  this.delay = randomInteger(2, 10) * 10000;
  this.fadeTime = randomInteger(5, 10) * 10000;
  this.alphaDivisor = this.fadeTime;
  this.xCoord(0, 4);
  this.yCoord(1, 3);
};

// Update the token's position
Token.prototype.update = function () {
  'use strict';
  this.setPerimeter();
  if (this.delay &lt;= 0 &amp;&amp; this.hit(player)) {
    player.tokenPoints += this.points;
    player.tokenLives += this.lives;
    this.reset();
  }
};

// Draw the token on the screen
Token.prototype.render = function () {
  'use strict';
  this.delay -= 100;
  if (this.delay &lt;= 0) {
    this.fadeTime -= 100;
    if (this.fadeTime &lt;= 0) {
      this.reset();
    } else {
      ctx.globalAlpha = this.fadeTime / this.alphaDivisor;
      GamePiece.prototype.render.call(this);
      ctx.globalAlpha = 1.0;
    }
  }
};

// --------------------------------------------------
// Instantiate objects
// --------------------------------------------------
// Place all enemy objects in an array called allEnemies
// Place the player object in a variable called player
var allEnemies = [new Enemy(), new Enemy(), new Enemy(), new Enemy(), new Enemy(), new Enemy()],
  player = new Player(),
  token = new Token();

// --------------------------------------------------
// Event Listeners
// --------------------------------------------------
// This listens for key presses and sends the keys to your
// Player.handleInput() method. You don't need to modify this.
document.addEventListener('keyup', function (e) {
  'use strict';
  var allowedKeys = {
    37: 'left',
    38: 'up',
    39: 'right',
    40: 'down'
  };

  player.handleInput(allowedKeys[e.keyCode]);
});

// TODO Player selects avatar
$('input[name="player"]').change(function () {
  'use strict';
  console.log($(this).val());
  var player = new Player($(this).val());
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Enemy.html">Enemy</a></li><li><a href="GamePiece.html">GamePiece</a></li></ul><h3>Global</h3><ul><li><a href="global.html#BLOCK_HEIGHT">BLOCK_HEIGHT</a></li><li><a href="global.html#BLOCK_HEIGHT_OFFSET">BLOCK_HEIGHT_OFFSET</a></li><li><a href="global.html#BLOCK_WIDTH">BLOCK_WIDTH</a></li><li><a href="global.html#FIELD_BOTTOM">FIELD_BOTTOM</a></li><li><a href="global.html#FIELD_LEFT">FIELD_LEFT</a></li><li><a href="global.html#FIELD_RIGHT">FIELD_RIGHT</a></li><li><a href="global.html#FIELD_TOP">FIELD_TOP</a></li><li><a href="global.html#randomInteger">randomInteger</a></li><li><a href="global.html#toggleAvatarSelection">toggleAvatarSelection</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Wed Sep 02 2015 02:56:34 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
